<!DOCTYPE html>
<head><title>RPG Ops</title>
<script src="https://browserid.org/include.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js">
  </script>
<script src="/dnode.js" type="text/javascript"></script>
<script>
  
var SESSIONID;

DNode({
    
    noSession: function (complaint) {
      $('#signin').show();
      $('#signout').hide();
      $('#whom').text(complaint || "You need to sign in, pal");
    },
      
    session : function (id, email) {
      $('#signout').show();
      $('#signin :visible').slideUp();
      $('#whom').text(email);
      SESSIONID = id;
      window.localStorage.setItem("sessionID", SESSIONID);
    },

  }).connect(function (remote) {
      
      if (window.localStorage) {
        remote.resumeSession(window.localStorage.getItem("sessionID"));
      }

      $("#signin").click(function () {
          $("#whom").text("Answer this:");
          navigator.id.getVerifiedEmail(function (assertion) {
              $("#whom").text("Thanks");
              if (assertion) {
                $("#whom").text("Verifying");
                // This code will be invoked once the user has successfully
                // selected an email address they control to sign in with.
                remote.verify(assertion);
              } else {
                // something went wrong!  the user isn't logged in.
                $("#whom").text("Nobody.");
              }
            });
        });

      $("#signout").click(function () {
          remote.signout();
        });

    });


</script>

<style>
    #signin, #signout { display: none; }
</style>

</head>

<body>
<h1 id=whom>Who are you?</h1>
<p id=reason></p>
<button  id="signin">
    <img src="https://browserid.org/i/sign_in_red.png" alt="Sign in">
</button>
<button id="signout">Sign out</button>
</body>
